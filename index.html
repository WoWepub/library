<script>

const repo = "wowepub.github.io"; // ✅ ဒီနေရာ FIX
const folder = "library";
const cacheKey = "bookCache_v1";

let books = [];

async function loadBooks(){

  const cache = localStorage.getItem(cacheKey);

  if(cache){
    books = JSON.parse(cache);
    renderBooks(books);
    refreshCache();
  }else{
    await refreshCache();
  }

}

async function refreshCache(){

  const url = `https://api.github.com/repos/${repo}/contents/${folder}`;

  const res = await fetch(url);
  const data = await res.json();

  books = data.map(file => {

    const name = file.name.replace(".epub","");

    return {
      name: name,
      link: file.download_url,
      cover: `covers/${name}.jpg`
    };

  });

  localStorage.setItem(cacheKey, JSON.stringify(books));

  renderBooks(books);

}

function renderBooks(list){

  const grid = document.getElementById("bookGrid");

  grid.innerHTML = list.map(book => `
    <a class="book" href="${book.link}">
      <img src="${book.cover}" loading="lazy"
      onerror="this.src='https://via.placeholder.com/300x450?text=No+Cover'">
      <div class="book-title">${book.name}</div>
    </a>
  `).join("");

}

document.getElementById("searchBox").addEventListener("input", e => {

  const q = e.target.value.toLowerCase();

  const filtered = books.filter(book =>
    book.name.toLowerCase().includes(q)
  );

  renderBooks(filtered);

});

loadBooks();

</script>
